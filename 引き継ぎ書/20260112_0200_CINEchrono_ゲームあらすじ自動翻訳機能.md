# CINEchrono TRAVEL 引き継ぎ書
## ゲームあらすじ自動翻訳・一括更新機能（2026/01/12）

---

## プロジェクト情報

| 項目 | 値 |
|------|-----|
| ローカルパス | `/Users/hiroec/Desktop/cinechrono` |
| GitHub | https://github.com/chiroe203/cinechrono |
| 本番URL | https://cinechrono.com |
| Firebase Project | cinechrono-1c1a8 |
| GA4測定ID | G-Z97NXZ5KV4 |
| microCMS | https://cinechrono.microcms.io |

---

## 今回のセッションで完了した作業

### 1. ゲームあらすじ自動翻訳機能 ⭐新規

RAWGから英語のあらすじを取得し、DeepL APIで日本語に翻訳する機能を追加。

| 項目 | 値 |
|------|-----|
| 翻訳API | DeepL API Free |
| APIキー | `f4e2412f-9ab7-4db9-beb1-878f33abce63:fx` |
| 無料枠 | 月50万文字 |
| 翻訳タイミング | 保存時のみ（表示時は保存済みデータを使用） |

### 2. 一括更新機能 ⭐新規

管理画面でゲームを選択し、一括であらすじを更新できる機能を追加。

```
┌─────────────────────────────────────────────────────────┐
│ 🎮 ゲームあらすじ一括更新                               │
│                                                         │
│ [ゲームのみ表示]                                        │
│                                                         │
│ ☑ 全選択 (5件)          選択中: 2件                    │
│                                                         │
│ ☑ アサシンクリード オデッセイ    🎮  紀元前431年        │
│ ☐ ゴースト・オブ・ツシマ        🎮  1274年             │
│ ☑ Red Dead Redemption 2        🎮  1899年             │
│                                                         │
│ [🔄 選択したゲームのあらすじを更新 (2件)]              │
│                                                         │
│ ※RAWGから英語あらすじを取得し、DeepLで日本語に翻訳     │
└─────────────────────────────────────────────────────────┘
```

### 3. 更新進捗表示

一括更新中はプログレスバーと処理状況を表示。

```
┌─────────────────────────────────────────────────────────┐
│ 🔄 更新中...                                            │
│                                                         │
│ 1 / 3                                                   │
│ [████████░░░░░░░░░░░░░░░░░░░░░░]                        │
│ 処理中: アサシンクリード オデッセイ                      │
│                                                         │
│ ✅ Red Dead Redemption 2                                │
└─────────────────────────────────────────────────────────┘
```

---

## 新規作成ファイル

### src/libs/deepl.js 🆕

DeepL API接続用ファイル。

```javascript
// エクスポートされる関数
export const translateToJapanese = async (text, sourceLang = 'EN') => {...}
export const translateMultipleToJapanese = async (texts, sourceLang = 'EN') => {...}
```

### src/libs/rawg.js（更新）

あらすじ取得機能を追加。

```javascript
// エクスポートされる関数
export const searchGame = async (gameName) => {...}  // descriptionを含む
export const getGameDetails = async (gameId) => {...}
export const formatReleaseDate = (dateStr) => {...}
```

---

## 変更ファイル一覧

| ファイル | 変更内容 |
|---------|---------|
| `src/libs/deepl.js` | 🆕 DeepL翻訳API接続 |
| `src/libs/rawg.js` | ✅ 変更不要（既にdescription取得対応済み） |
| `src/components/admin/AdminPanel.jsx` | チェックボックス、一括更新ボタン、進捗表示を追加 |
| `src/components/modals/DetailModal.jsx` | ゲームの`translatedDescription`を「あらすじ」として表示 |
| `src/App.js` | DeepLインポート、bulkUpdateGameSynopsis関数追加 |

---

## データ構造

### 新しいフィールド
```
translatedDescription: "RAWG+DeepLで翻訳されたあらすじ"
```

### 表示の整理
| | 映画・ドラマ・アニメ | ゲーム |
|---|---|---|
| **あらすじ** | TMDBから自動取得（overview） | `translatedDescription`（RAWG+DeepL） |
| **💡 ひとことTips** | 手動入力（synopsis） | 手動入力（synopsis） |

---

## 環境変数設定

### .env.local（ローカル）に追加
```
# DeepL API（翻訳）
REACT_APP_DEEPL_API_KEY=f4e2412f-9ab7-4db9-beb1-878f33abce63:fx
```

### Vercel環境変数（本番）に追加
| Key | Value | Note |
|-----|-------|------|
| `REACT_APP_DEEPL_API_KEY` | `f4e2412f-9ab7-4db9-beb1-878f33abce63:fx` | DeepL翻訳API |

---

## 使い方

### ゲームあらすじを一括更新する場合

1. 管理画面 → 作品タブ
2. 「ゲームあらすじ一括更新」エリアが表示される
3. 「ゲームのみ表示」ボタンで絞り込み（任意）
4. 更新したいゲームにチェックを入れる
5. 「選択したゲームのあらすじを更新」ボタンをクリック
6. 進捗バーで処理状況を確認
7. 完了後、結果がアラートで表示される

### 注意事項

- **英語タイトルが必須**: RAWGは英語タイトルで検索するため、英語タイトルが未入力のゲームは更新できません
- **既存のひとことTipsは上書き**: synopsisフィールドに日本語あらすじが保存されます
- **API制限対策**: 1件ごとに0.5秒の待機を入れています

---

## デプロイ手順

### 1. ファイル配置

以下のファイルを配置/上書き：
- `src/libs/deepl.js` ← 新規作成
- `src/libs/rawg.js` ← 上書き
- `src/components/admin/AdminPanel.jsx` ← 上書き
- `src/App.js` ← 上書き

### 2. 環境変数を追加

#### ローカル（.env.local）
```
REACT_APP_DEEPL_API_KEY=f4e2412f-9ab7-4db9-beb1-878f33abce63:fx
```

#### Vercel（Settings → Environment Variables）
| Key | Value |
|-----|-------|
| `REACT_APP_DEEPL_API_KEY` | `f4e2412f-9ab7-4db9-beb1-878f33abce63:fx` |

### 3. 動作確認

```bash
cd /Users/hiroec/Desktop/cinechrono
npm start
```

**確認ポイント：**
- [ ] 管理画面の作品タブに「ゲームあらすじ一括更新」エリアが表示される
- [ ] 「ゲームのみ表示」ボタンで絞り込みができる
- [ ] ゲームにチェックを入れられる
- [ ] 「全選択」ボタンが動作する
- [ ] 一括更新ボタンをクリックすると処理が開始される
- [ ] 進捗バーが表示される
- [ ] 完了後にアラートが表示される
- [ ] Firestoreにあらすじが保存される

### 4. デプロイ

```bash
git add .
git commit -m "ゲームあらすじ自動翻訳・一括更新機能（RAWG + DeepL連携）"
git push
```

---

## API使用量の目安

| ゲーム数 | あらすじ文字数（目安） | 月間消費（目安） |
|---------|---------------------|----------------|
| 10本 | 約4,000文字 | 約4,000文字 |
| 50本 | 約20,000文字 | 約20,000文字 |
| 100本 | 約40,000文字 | 約40,000文字 |

**DeepL Free: 月50万文字 → 約1,000〜1,500本分**

登録時のみAPI消費するため、余裕で賄えます。

---

## トラブルシューティング

### 翻訳されない場合

1. `.env.local`にDeepL APIキーが設定されているか確認
2. `npm start`を再起動（環境変数は再起動で読み込み）
3. ブラウザのコンソールでエラーを確認

### 「英語タイトルがありません」エラー

→ 対象ゲームに英語タイトルを入力してください

### 「RAWGからあらすじを取得できませんでした」エラー

→ 英語タイトルが正しいか確認（RAWGで検索してみる）
→ 一部のゲームはRAWGにあらすじが登録されていない場合があります

---

## 重要なメモ

| 項目 | 内容 |
|------|------|
| ローカルパス | `/Users/hiroec/Desktop/cinechrono` |
| GitHub | https://github.com/chiroe203/cinechrono |
| Firebase Project ID | `cinechrono-1c1a8` |
| 管理者メール | hi6.chi.330018@gmail.com |
| Firebase Console | https://console.firebase.google.com/project/cinechrono-1c1a8 |
| Vercel URL | https://cinechrono-lemon.vercel.app |
| 本番ドメイン | https://cinechrono.com |
| ドメイン管理 | さくらインターネット |
| GA4測定ID | G-Z97NXZ5KV4 |
| Search Console | https://search.google.com/search-console |
| microCMS管理画面 | https://cinechrono.microcms.io |
| microCMSサービスID | cinechrono |
| RAWG APIキー | 1fd507dc8cf84472a682eb0f6c1ad2f6 |
| TMDB APIキー | 93f9dffd23f8e06c020b3f5f0d7d187d |
| DeepL APIキー | f4e2412f-9ab7-4db9-beb1-878f33abce63:fx |

---

## 更新履歴

| 日時 | 内容 |
|------|------|
| 2024/12/18 | プロジェクト作成、GitHub連携完了 |
| 2024/12/18 23:30 | Firebase Authentication・Firestore連携完了 |
| 2024/12/19 10:30 | サムネイル機能・世紀区切り線追加、Vercelデプロイ完了 |
| 2024/12/19 23:45 | アフィリエイト拡張、イベント統合、表示設定機能追加 |
| 2024/12/20 01:30 | 年表ソートロジック修正、アフィリエイトUI全面リデザイン |
| 2024/12/20 18:30 | GA4導入、電子書籍サービス拡充、親子関係機能実装、parseYear改善 |
| 2024/12/21 01:30 | Search Console設定、Aboutページ更新、App.js構文修正 |
| 2024/12/21 19:00 | URLルーティング導入、年号サジェスト、編集バグ修正 |
| 2024/12/21 22:30 | トリビア機能実装 |
| 2024/12/22 00:50 | トリビア機能完成、現在年マーカー追加 |
| 2025/12/26 14:00 | Search Console対応、ドメインリダイレクト設定 |
| 2026/01/10 18:20 | microCMS連携、トピック記事ページ追加 |
| 2026/01/10 20:10 | RAWG・TMDB API連携、ひとことTips機能追加 |
| 2026/01/10 21:45 | サムネイル自動取得機能、モーダルレイアウト修正 |
| 2026/01/10 21:50 | 本番環境API設定完了（Vercel環境変数追加） |
| 2026/01/11 00:30 | 時代設定タイプ機能追加（settingTypes: 複数選択対応） |
| 2026/01/11 10:30 | 時代設定アイコン表示ロジック修正 |
| 2026/01/11 21:00 | App.js分割フェーズ1-3完了（412行削減） |
| 2026/01/11 22:00 | App.js分割フェーズ4完了（合計524行削減） |
| 2026/01/11 22:30 | App.js分割フェーズ5完了（合計818行削減） |
| 2026/01/11 23:00 | App.js分割フェーズ6完了（合計1,531行削減） |
| 2026/01/11 23:30 | App.js分割フェーズ7-8完了（合計2,310行削減） |
| 2026/01/12 01:00 | 映画検索絞り込み機能強化（監督/俳優名＆公開年対応） |
| 2026/01/12 02:00 | ゲームあらすじ自動翻訳・一括更新機能（RAWG + DeepL連携）🆕 |

---

## 関連ドキュメント

- 前回の引き継ぎ書: `20260112_0100_CINEchrono_映画検索絞り込み機能強化.md`

---

## 作成日時
2026年1月12日 02:00

## 作成者
Claude（Anthropic）
