# CINEchrono TRAVEL 開発引き継ぎドキュメント

## 📋 プロジェクト概要

| 項目 | 内容 |
|------|------|
| プロジェクト名 | CINEchrono TRAVEL |
| ドメイン | cinechrono.com |
| 本番URL | https://cinechrono.com |
| Vercel URL | https://cinechrono-lemon.vercel.app |
| 目的 | 歴史的瞬間と映画・漫画・ゲームを年表で繋ぐWebアプリ |
| ターゲット | 中高生（世界史学習者） |
| ローカルパス | `/Users/hiroec/Desktop/cinechrono` |
| GitHub | https://github.com/chiroe203/cinechrono |

---

## ✅ 完了した作業

### Phase 1-4: 基盤構築（以前完了）
- ✅ Node.js・React・Tailwind CSS 環境構築
- ✅ GitHubリポジトリ作成・連携
- ✅ Firebase Authentication・Firestore連携
- ✅ Vercelデプロイ・カスタムドメイン設定

### Phase 5-6: 機能拡張（以前完了）
- ✅ サムネイル画像機能
- ✅ 世紀区切り線・紀元区切り線
- ✅ 紀元前（BC）対応
- ✅ Aboutページ作成
- ✅ アフィリエイトリンクシステム拡張
- ✅ イベントシステム再設計
- ✅ アフィリエイト表示オン/オフ機能

### Phase 7: 今回の作業 🆕

#### 1. Google Analytics 4 導入
- ✅ GA4プロパティ作成・設定完了
- ✅ 測定ID: `G-Z97NXZ5KV4`
- ✅ index.htmlにトラッキングコード追加

#### 2. 電子書籍サービスの拡充
- ✅ 新サービス追加: Kindle、楽天Kobo、BookLive!、コミックシーモア、DMMブックス、Renta!
- ✅ ブランドカラー設定（各サービスの公式色に準拠）
- ✅ 表示順序の固定: 電子書籍 → 配信 → 購入 → ゲーム → その他

#### 3. アフィリエイトUIの改善
- ✅ カテゴリ別グループ表示（グレーの箱でまとめ）
- ✅ カテゴリラベル表示

#### 4. 親子関係機能の実装
- ✅ 作品に「親となる時代区分」を設定可能に
- ✅ 親を設定した場合、年号入力を任意化
- ✅ 年号なしの作品は親グループ内の最後に表示
- ✅ 大区分をまたいだ親子関係のサポート
- ✅ 親グループ内の表示順序: アイテム → 親を持つコンテンツ → 子時代区分

#### 5. parseYear関数の全面改善
- ✅ 様々な年号表記に対応
- ✅ 異常値の防御処理追加

#### 6. 管理画面の簡素化
- ✅ 「時代区分（任意）」入力欄を削除（親となる時代区分に統合）

---

## 🔥 Firebase 設定情報

### プロジェクト情報
```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDyJ6IhfEAf6Bsf7LTQ5YByG8T-ou6cXwE",
  authDomain: "cinechrono-1c1a8.firebaseapp.com",
  projectId: "cinechrono-1c1a8",
  storageBucket: "cinechrono-1c1a8.firebasestorage.app",
  messagingSenderId: "1029924381560",
  appId: "1:1029924381560:web:5c36f1b9ac2ed2f7a09e8d"
};
```

### Firebase Console
- URL: https://console.firebase.google.com/project/cinechrono-1c1a8

### 管理者アカウント
- メールアドレス: `hi6.chi.330018@gmail.com`

### Firestoreコレクション
| コレクション | 用途 |
|-------------|------|
| `timeline` | 年表データ（作品・時代区分・イベント） |
| `settings` | グローバル設定（アフィリエイト表示等） |

---

## 📊 Google Analytics 設定

| 項目 | 値 |
|------|-----|
| アカウント | cinechrono (378013636) |
| プロパティ | CINEchrono (516865667) |
| 測定ID | G-Z97NXZ5KV4 |
| ダッシュボード | https://analytics.google.com |

---

## 🎯 parseYear関数の対応形式

| 入力形式 | 出力例 | 説明 |
|---------|--------|------|
| `1547` | 1547 | そのまま |
| `15世紀` | 1401 | 世紀の開始年 |
| `15世紀前期` / `前半` | 1416 | 開始年+15 |
| `15世紀中期` / `中頃` | 1451 | 開始年+50 |
| `15世紀後期` / `後半` | 1486 | 開始年+85 |
| `15世紀頃` | 1401 | 開始年 |
| `1430年代` | 1430 | そのまま |
| `1430年代後半` | 1438 | +8 |
| `1966-1974` | 1966 | 最初の年を使用 |
| `紀元前264年` / `BC264` | -264 | 負の数 |

---

## 🔗 親子関係機能

### 使い方
1. 作品追加画面で「親となる時代区分」を選択
2. 年号は任意（空欄可）
3. 保存すると親グループ内に表示

### 表示順序
```
⚔️ 第二次世界大戦
   1939

   1940
   ┌ ダンケルク ┐

   1942
   ┌ 戦場のメリークリスマス ┐

   ┌ シンドラーのリスト ┐     ← 親を持つコンテンツ
   ┌ 窓ぎわのトットちゃん ┐

   📜 ポツダム宣言              ← 子時代区分（最後）
      1945
```

### 注意点
- 親を設定した作品は、親の大区分（mainEra）に配置される
- 年号なしの作品はグループ内の最後に表示
- 子時代区分（条約など）は親を持つコンテンツより後に表示

---

## 📚 電子書籍サービス一覧

| サービス | ID | 色 |
|---------|-----|-----|
| Kindle | kindle | オレンジ |
| 楽天Kobo | rakuten_kobo | 赤 |
| BookLive! | booklive | オレンジ→赤 |
| コミックシーモア | cmoa | アンバー→オレンジ |
| DMMブックス | dmm_books | ピンク→赤 |
| Renta! | renta | ライム→グリーン |

---

## 📂 現在のファイル構成

```
cinechrono/
├── public/
│   ├── index.html          # GA4トラッキングコード含む
│   └── favicon.ico
├── src/
│   ├── App.js              # メインコード（最新版）
│   ├── firebase.js         # Firebase設定ファイル
│   ├── index.js
│   └── index.css           # Tailwind CSS
├── node_modules/
├── package.json
├── tailwind.config.js
└── .gitignore
```

---

## 🔄 更新フロー

### コード更新時
```bash
# 1. ファイルを編集
# 2. ローカルで確認
cd /Users/hiroec/Desktop/cinechrono
npm start

# 3. Gitにコミット・プッシュ
git add .
git commit -m "機能追加: ○○"
git push

# 4. Vercelが自動デプロイ（1-2分）
```

### 大きなファイルのプッシュ時
```bash
git config http.postBuffer 524288000
git push
```

---

## 🚀 次のステップ

### 直近のタスク
- ⏳ プライバシーポリシーページ作成
- ⏳ アフィリエイトプログラム申請

### コンテンツ充実
- 目標: 各時代 5-10作品
- 合計: 50-100作品
- サムネイル画像も追加推奨

### 今後の機能追加案
- 検索機能
- お気に入り機能
- ユーザーからのリクエスト機能
- A/Bテスト分析（アフィリエイト有無での比較）

---

## 🛠️ トラブルシューティング

### よくあるエラー

**1. `npm start` でエラー**
```bash
rm -rf node_modules package-lock.json
npm install
npm start
```

**2. Gitプッシュでエラー（HTTP 400）**
```bash
git config http.postBuffer 524288000
git push
```

**3. 年表の順番がおかしい**
- 「主な時代」（紫色の年号）が正しく入力されているか確認
- 「大体の時期」はソートに影響しない（表示用のみ）
- 同じ年号のアイテムはsubEra（時代区分）の有無で分離される可能性あり

**4. 親グループに作品が表示されない**
- 親の時代区分が存在するか確認
- 親の大区分と作品の大区分が一致しているか確認（自動修正される）

**5. 世紀マーカーがおかしい**
- parseYear関数が対応していない形式の可能性
- 対応形式: 数字、XX世紀、XXXX年代、XXXX-XXXX

---

## 📞 次のチャットで伝えること

「CINEchrono TRAVELの開発を続けたい。引き継ぎドキュメントがある。親子関係機能・年表ソート改善完了済み。次は○○をしたい。」

と伝えれば、Claudeがスムーズに対応します！

---

## 📝 重要なメモ

| 項目 | 内容 |
|------|------|
| ローカルパス | `/Users/hiroec/Desktop/cinechrono` |
| GitHub | https://github.com/chiroe203/cinechrono |
| Firebase Project ID | `cinechrono-1c1a8` |
| 管理者メール | hi6.chi.330018@gmail.com |
| Firebase Console | https://console.firebase.google.com/project/cinechrono-1c1a8 |
| Vercel URL | https://cinechrono-lemon.vercel.app |
| 本番ドメイン | https://cinechrono.com |
| ドメイン管理 | さくらインターネット |
| GA4測定ID | G-Z97NXZ5KV4 |

---

## 🎊 現在の進捗: 98%

- ✅ プロジェクト作成
- ✅ コード実装
- ✅ GitHub 連携
- ✅ Firebase データベース連携
- ✅ Vercel デプロイ
- ✅ ドメイン接続
- ✅ アフィリエイトリンクシステム拡張
- ✅ イベントシステム再設計
- ✅ アフィリエイト表示設定機能
- ✅ 年表ソートロジック修正
- ✅ アフィリエイトUI改善
- ✅ Google Analytics 4 導入 🆕
- ✅ 電子書籍サービス拡充 🆕
- ✅ 親子関係機能実装 🆕
- ✅ parseYear関数改善 🆕
- ⏳ コンテンツ充実
- ⏳ アフィリエイトプログラム申請

---

## 📅 更新履歴

| 日時 | 内容 |
|------|------|
| 2024/12/18 | プロジェクト作成、GitHub連携完了 |
| 2024/12/18 23:30 | Firebase Authentication・Firestore連携完了 |
| 2024/12/19 10:30 | サムネイル機能・世紀区切り線追加、Vercelデプロイ完了 |
| 2024/12/19 23:45 | アフィリエイト拡張、イベント統合、表示設定機能追加 |
| 2024/12/20 01:30 | 年表ソートロジック修正、アフィリエイトUI全面リデザイン |
| 2024/12/20 18:30 | GA4導入、電子書籍サービス拡充、親子関係機能実装、parseYear改善 🆕 |

---

## ✨ 完成イメージ

```
ユーザー
  ↓
cinechrono.com にアクセス
  ↓
年表を閲覧（親子関係で整理された表示）
  ↓
作品クリック → アフィリエイトリンク（カテゴリ別グループ表示）
  ↓
購入 → 収益発生

管理者（あなた）
  ↓
フッター歯車 → ログイン
  ↓
管理画面 → アフィリエイト表示をオン/オフ
  ↓
作品追加（親となる時代区分を選択可能）
  ↓
Firebase に保存
  ↓
全ユーザーに即反映
  ↓
Google Analyticsで効果測定
```

---

頑張ってください！🚀
